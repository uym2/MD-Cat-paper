#facet_grid(cols=vars(treeModel),scale="free") +
#geom_vline(xintercept = 1,color="red")+
scale_x_continuous(name="Portion of branches",trans="log10",labels=percent,
breaks = c(0.01,0.1,0.33,1,10,100))+
coord_cartesian(xlim=c(0.001,9))+
#scale_x_discrete(name="branch length percentile")+
scale_fill_brewer(palette = 7,direction = -1,name="Inside 95% CI: ")+
theme_bw() + theme(legend.position = "right",
panel.border = element_rect(colour = "black", fill=NA))
d1 %>%  filter(trueTime<p0025 | trueTime>p0975) %>%
mutate(d=ifelse(trueTime<p0025,(p0025-trueTime)/trueTime,(trueTime-p0975)/trueTime)) %>%
ggplot()+
stat_ecdf(aes(x=d,color=clockModel,linetype=treeModel))+
#facet_grid(cols=vars(treeModel),scale="free") +
#geom_vline(xintercept = 1,color="red")+
scale_x_continuous(name="Portion of branches",trans="log10",labels=percent,
breaks = c(0.01,0.1,0.33,1,10,100))+
coord_cartesian(xlim=c(0.001,8))+
#scale_x_discrete(name="branch length percentile")+
scale_fill_brewer(palette = 7,direction = -1,name="Inside 95% CI: ")+
theme_bw() + theme(legend.position = "right",
panel.border = element_rect(colour = "black", fill=NA))
d1 %>%  filter(trueTime<p0025 | trueTime>p0975) %>%
mutate(d=ifelse(trueTime<p0025,(p0025-trueTime)/trueTime,(trueTime-p0975)/trueTime)) %>%
ggplot()+
stat_ecdf(aes(x=d,color=clockModel,linetype=treeModel))+
#facet_grid(cols=vars(treeModel),scale="free") +
#geom_vline(xintercept = 1,color="red")+
scale_x_continuous(name="Portion of branches",trans="log10",labels=percent,
breaks = c(0.01,0.1,0.33,1,10,50))+
coord_cartesian(xlim=c(0.001,8))+
#scale_x_discrete(name="branch length percentile")+
scale_fill_brewer(palette = 7,direction = -1,name="Inside 95% CI: ")+
theme_bw() + theme(legend.position = "right",
panel.border = element_rect(colour = "black", fill=NA))
d1 %>%  filter(trueTime<p0025 | trueTime>p0975) %>%
mutate(d=ifelse(trueTime<p0025,(p0025-trueTime)/trueTime,(trueTime-p0975)/trueTime)) %>%
ggplot()+
stat_ecdf(aes(x=d,color=clockModel,linetype=treeModel))+
#facet_grid(cols=vars(treeModel),scale="free") +
#geom_vline(xintercept = 1,color="red")+
scale_x_continuous(name="Portion of branches",trans="log10",labels=percent,
breaks = c(0.01,0.33,0.1,0.33,1,10,33))+
coord_cartesian(xlim=c(0.001,8))+
#scale_x_discrete(name="branch length percentile")+
scale_fill_brewer(palette = 7,direction = -1,name="Inside 95% CI: ")+
theme_bw() + theme(legend.position = "right",
panel.border = element_rect(colour = "black", fill=NA))
d1 %>%  filter(trueTime<p0025 | trueTime>p0975) %>%
mutate(d=ifelse(trueTime<p0025,(p0025-trueTime)/trueTime,(trueTime-p0975)/trueTime)) %>%
ggplot()+
stat_ecdf(aes(x=d,color=clockModel,linetype=treeModel))+
#facet_grid(cols=vars(treeModel),scale="free") +
#geom_vline(xintercept = 1,color="red")+
scale_x_continuous(name="Portion of branches",trans="log10",labels=percent,
breaks = c(0.01,0.33,0.1,0.33,1,3.3))+
coord_cartesian(xlim=c(0.001,8))+
#scale_x_discrete(name="branch length percentile")+
scale_fill_brewer(palette = 7,direction = -1,name="Inside 95% CI: ")+
theme_bw() + theme(legend.position = "right",
panel.border = element_rect(colour = "black", fill=NA))
d1 %>%  filter(trueTime<p0025 | trueTime>p0975) %>%
mutate(d=ifelse(trueTime<p0025,(p0025-trueTime)/trueTime,(trueTime-p0975)/trueTime)) %>%
ggplot()+
stat_ecdf(aes(x=d,color=clockModel,linetype=treeModel))+
#facet_grid(cols=vars(treeModel),scale="free") +
#geom_vline(xintercept = 1,color="red")+
scale_x_continuous(name="Portion of branches",trans="log10",labels=percent,
breaks = c(0.01,0.33,0.1,0.33,1,3.3))+
coord_cartesian(xlim=c(0.001,9))+
#scale_x_discrete(name="branch length percentile")+
scale_fill_brewer(palette = 7,direction = -1,name="Inside 95% CI: ")+
theme_bw() + theme(legend.position = "right",
panel.border = element_rect(colour = "black", fill=NA))
d1 %>%  filter(trueTime<p0025 | trueTime>p0975) %>%
mutate(d=ifelse(trueTime<p0025,(p0025-trueTime)/trueTime,(trueTime-p0975)/trueTime)) %>%
ggplot()+
stat_ecdf(aes(x=d,color=clockModel,linetype=treeModel))+
#facet_grid(cols=vars(treeModel),scale="free") +
#geom_vline(xintercept = 1,color="red")+
scale_x_continuous(name="Portion of branches",trans="log10",labels=percent,
breaks = c(0.01,0.33,0.1,0.33,1,3.3,1))+
coord_cartesian(xlim=c(0.001,9))+
#scale_x_discrete(name="branch length percentile")+
scale_fill_brewer(palette = 7,direction = -1,name="Inside 95% CI: ")+
theme_bw() + theme(legend.position = "right",
panel.border = element_rect(colour = "black", fill=NA))
d1 %>%  filter(trueTime<p0025 | trueTime>p0975) %>%
mutate(d=ifelse(trueTime<p0025,(p0025-trueTime)/trueTime,(trueTime-p0975)/trueTime)) %>%
ggplot()+
stat_ecdf(aes(x=d,color=clockModel,linetype=treeModel))+
#facet_grid(cols=vars(treeModel),scale="free") +
#geom_vline(xintercept = 1,color="red")+
scale_x_continuous(name="Portion of branches",trans="log10",labels=percent,
breaks = c(0.01,0.33,0.1,0.33,1,3.3,1))+
coord_cartesian(xlim=c(0.001,8))+
#scale_x_discrete(name="branch length percentile")+
scale_fill_brewer(palette = 7,direction = -1,name="Inside 95% CI: ")+
theme_bw() + theme(legend.position = "right",
panel.border = element_rect(colour = "black", fill=NA))
d1 %>%  filter(trueTime<p0025 | trueTime>p0975) %>%
mutate(d=ifelse(trueTime<p0025,(p0025-trueTime)/trueTime,(trueTime-p0975)/trueTime)) %>%
ggplot()+
stat_ecdf(aes(x=d,color=clockModel,linetype=treeModel))+
#facet_grid(cols=vars(treeModel),scale="free") +
#geom_vline(xintercept = 1,color="red")+
scale_x_continuous(name="Portion of branches",trans="log10",labels=percent,
breaks = c(0.01,0.33,0.1,0.33,1,3.3,1))+
coord_cartesian(xlim=c(0.0001,8))+
#scale_x_discrete(name="branch length percentile")+
scale_fill_brewer(palette = 7,direction = -1,name="Inside 95% CI: ")+
theme_bw() + theme(legend.position = "right",
panel.border = element_rect(colour = "black", fill=NA))
d1 %>%  filter(trueTime<p0025 | trueTime>p0975) %>%
mutate(d=ifelse(trueTime<p0025,(p0025-trueTime)/trueTime,(trueTime-p0975)/trueTime)) %>%
ggplot()+
stat_ecdf(aes(x=d,color=clockModel,linetype=treeModel))+
#facet_grid(cols=vars(treeModel),scale="free") +
#geom_vline(xintercept = 1,color="red")+
scale_x_continuous(name="Portion of branches",trans="log10",labels=percent,
breaks = c(0.01,0.33,0.1,0.33,1,3.3,1))+
coord_cartesian(xlim=c(0.0003,8))+
#scale_x_discrete(name="branch length percentile")+
scale_fill_brewer(palette = 7,direction = -1,name="Inside 95% CI: ")+
theme_bw() + theme(legend.position = "right",
panel.border = element_rect(colour = "black", fill=NA))
d1 %>%  filter(trueTime<p0025 | trueTime>p0975) %>%
mutate(d=ifelse(trueTime<p0025,(p0025-trueTime)/trueTime,(trueTime-p0975)/trueTime)) %>%
ggplot()+
stat_ecdf(aes(x=d,color=clockModel,linetype=treeModel))+
#facet_grid(cols=vars(treeModel),scale="free") +
#geom_vline(xintercept = 1,color="red")+
scale_x_continuous(name="Portion of branches",trans="log10",labels=percent,
breaks = c(0.01,0.33,0.1,0.33,1,3.3,1))+
#coord_cartesian(xlim=c(0.0003,8))+
#scale_x_discrete(name="branch length percentile")+
scale_fill_brewer(palette = 7,direction = -1,name="Inside 95% CI: ")+
theme_bw() + theme(legend.position = "right",
panel.border = element_rect(colour = "black", fill=NA))
d1 %>%  filter(trueTime<p0025 | trueTime>p0975) %>%
mutate(d=ifelse(trueTime<p0025,(p0025-trueTime)/trueTime,(trueTime-p0975)/trueTime)) %>%
ggplot()+
stat_ecdf(aes(x=d,color=clockModel,linetype=treeModel))+
#facet_grid(cols=vars(treeModel),scale="free") +
#geom_vline(xintercept = 1,color="red")+
scale_x_continuous(name="Portion of branches",trans="log10",labels=percent,
breaks = c(0.01,0.033,0.1,0.33,1,3.3,1))+
#coord_cartesian(xlim=c(0.0003,8))+
#scale_x_discrete(name="branch length percentile")+
scale_fill_brewer(palette = 7,direction = -1,name="Inside 95% CI: ")+
theme_bw() + theme(legend.position = "right",
panel.border = element_rect(colour = "black", fill=NA))
d1 %>%  filter(trueTime<p0025 | trueTime>p0975) %>%
mutate(d=ifelse(trueTime<p0025,(p0025-trueTime)/trueTime,(trueTime-p0975)/trueTime)) %>%
ggplot()+
stat_ecdf(aes(x=d,color=clockModel,linetype=treeModel))+
#facet_grid(cols=vars(treeModel),scale="free") +
#geom_vline(xintercept = 1,color="red")+
scale_x_continuous(name="Portion of branches",trans="log10",labels=percent,
breaks = c(0.01,0.033,0.1,0.33,1,3.3,1))+
coord_cartesian(xlim=c(0.0003,8))+
#scale_x_discrete(name="branch length percentile")+
scale_fill_brewer(palette = 7,direction = -1,name="Inside 95% CI: ")+
theme_bw() + theme(legend.position = "right",
panel.border = element_rect(colour = "black", fill=NA))
d1 %>%  filter(trueTime<p0025 | trueTime>p0975) %>%
mutate(d=ifelse(trueTime<p0025,(p0025-trueTime)/trueTime,(trueTime-p0975)/trueTime)) %>%
ggplot()+
stat_ecdf(aes(x=d,color=clockModel,linetype=treeModel))+
#facet_grid(cols=vars(treeModel),scale="free") +
#geom_vline(xintercept = 1,color="red")+
scale_x_continuous(name="Portion of branches",trans="log10",labels=percent,
breaks = c(0.01,0.033,0.1,0.33,1,3.3,1))+
coord_cartesian(xlim=c(0.0005,8))+
#scale_x_discrete(name="branch length percentile")+
scale_fill_brewer(palette = 7,direction = -1,name="Inside 95% CI: ")+
theme_bw() + theme(legend.position = "right",
panel.border = element_rect(colour = "black", fill=NA))
d1 %>%  filter(trueTime<p0025 | trueTime>p0975) %>%
mutate(d=ifelse(trueTime<p0025,(p0025-trueTime)/trueTime,(trueTime-p0975)/trueTime)) %>%
ggplot()+
stat_ecdf(aes(x=d,color=clockModel,linetype=treeModel))+
#facet_grid(cols=vars(treeModel),scale="free") +
#geom_vline(xintercept = 1,color="red")+
scale_color_brewer(palette = "Set2")+
scale_x_continuous(name="Portion of branches",trans="log10",labels=percent,
breaks = c(0.01,0.033,0.1,0.33,1,3.3,1))+
coord_cartesian(xlim=c(0.0005,8))+
#scale_x_discrete(name="branch length percentile")+
scale_fill_brewer(palette = 7,direction = -1,name="Inside 95% CI: ")+
theme_bw() + theme(legend.position = "right",
panel.border = element_rect(colour = "black", fill=NA))
ggsave("HIV-support-delta.pdf",width=8,height = 3)
ggsave("HIV-support-delta.pdf",width=8,height = 2.5)
d = read.table("MDCat_HIVsim_CI.txt",header=T)
d$inside = (d$trueTime >= d$p0025 & d$trueTime <= d$p0975)
h = data.frame("treeModel"=c("D750_11_10","D750_3_25","D995_11_10","D995_3_25"),
"height"=c(29.3667,66.8334,22.4934,32.4669),
"name"=c("M3","M4","M1","M2"))
d1 = merge(d,h)
d1$clockModel = factor(d1$clockModel,levels=c("trilnormcave","trilnormvex","trilnorm"),labels=c("Trimodal1","Trimodal2","Trimodal3"))
ggplot(d1) + geom_segment(aes(x=trueTime/height,y=p0025/height,xend=trueTime/height,yend=p0975/height,color=inside),size=0.2,alpha=0.5) +
geom_abline() + facet_grid(rows=vars(clockModel),cols=vars(treeModel),scale="free") +
theme_classic() + theme(legend.position = "None",panel.border = element_rect(colour = "black", fill=NA)) +
xlab("Normalized true branch length (year/height)") + ylab("Normalized estimated branch length (year/height)")
ggsave("MDCat_HIVsim_CI.pdf",width=6,height=4)
ggsave("MDCat_HIVsim_CI.pdf",width=7,height=4)
head(d1)
library(dplyr)
d1 %>% group_by(clockModel,treeModel) %>%
mutate(blg=cut(trueTime/height, quantile(trueTime/height,(0:10)/10), include.lowest = T,
labels = c(1:10)*10)) %>%
group_by(clockModel,treeModel,blg) %>%
mutate(c=n()) %>%
group_by(clockModel,treeModel,blg,inside) %>%
summarise(n=n()/unique(c)[1]) %>%
ggplot(aes(x=blg,fill=inside,y=n))+
geom_bar(aes(),stat="identity")+
facet_grid(rows=vars(clockModel),cols=vars(treeModel),scale="free") +
geom_hline(yintercept = 0.95,color="red")+
scale_y_continuous(labels=percent,name="Portion of branches")+
scale_x_discrete(name="branch length percentile")+
scale_fill_brewer(palette = 7,direction = -1,name="Inside 95% CI: ")+
theme_classic() + theme(legend.position = "bottom",
panel.border = element_rect(colour = "black", fill=NA))
ggsave("HIV-support.pdf",width=8,height = 4.5)
head(d1)
d1 %>%
ggplot()+
stat_ecdf(aes(x=p0025/trueTime,linetype=p0025/trueTime>1),color="blue")+
stat_ecdf(aes(x=trueTime/p0975,linetype=trueTime/p0975>1),color="green")+
facet_grid(rows=vars(clockModel),cols=vars(treeModel),scale="free") +
geom_vline(xintercept = 1,color="red")+
scale_x_continuous(name="Portion of branches")+
#scale_x_discrete(name="branch length percentile")+
scale_fill_brewer(palette = 7,direction = -1,name="Inside 95% CI: ")+
theme_classic() + theme(legend.position = "bottom",
panel.border = element_rect(colour = "black", fill=NA))
d1 %>%  filter(trueTime<p0025 | trueTime>p0975) %>%
mutate(d=ifelse(trueTime<p0025,(p0025-trueTime)/trueTime,(trueTime-p0975)/trueTime)) %>%
ggplot()+
stat_ecdf(aes(x=d,color=clockModel,linetype=treeModel))+
#facet_grid(cols=vars(treeModel),scale="free") +
#geom_vline(xintercept = 1,color="red")+
scale_color_brewer(palette = "Set2")+
scale_x_continuous(name="Portion of branches",trans="log10",labels=percent,
breaks = c(0.01,0.033,0.1,0.33,1,3.3,1))+
coord_cartesian(xlim=c(0.0005,8))+
#scale_x_discrete(name="branch length percentile")+
scale_fill_brewer(palette = 7,direction = -1,name="Inside 95% CI: ")+
theme_bw() + theme(legend.position = "right",
panel.border = element_rect(colour = "black", fill=NA))
ggsave("HIV-support-delta.pdf",width=8,height = 2.3)
d1 %>% group_by(clockModel,treeModel) %>%
mutate(blg=cut(trueTime/height, quantile(trueTime/height,(0:10)/10), include.lowest = T,
labels = c(1:10)*10)) %>%
group_by(clockModel,treeModel,blg) %>%
mutate(c=n()) %>%
group_by(clockModel,treeModel,blg,inside) %>%
summarise(n=n()/unique(c)[1]) %>%
ggplot(aes(x=blg,fill=inside,y=n))+
geom_bar(aes(),stat="identity")+
facet_grid(rows=vars(clockModel),cols=vars(treeModel),scale="free") +
geom_hline(yintercept = 0.95,color="red")+
scale_y_continuous(labels=percent,name="Portion of branches")+
scale_x_discrete(name="branch length percentile")+
scale_fill_brewer(palette = 7,direction = -1,name="Inside 95% CI: ")+
theme_classic() + theme(legend.position = "bottom",
panel.border = element_rect(colour = "black", fill=NA))
ggsave("HIV-support.pdf",width=8.5,height = 4.7)
d1 %>% group_by(clockModel,treeModel) %>%
mutate(blg=cut(trueTime/height, quantile(trueTime/height,(0:10)/10), include.lowest = T,
labels = c(1:10)*10)) %>%
group_by(clockModel,treeModel,blg) %>%
mutate(c=n()) %>%
group_by(clockModel,treeModel,blg,inside) %>%
summarise(n=n()/unique(c)[1]) %>%
ggplot(aes(x=blg,fill=inside,y=n))+
geom_bar(aes(),stat="identity")+
facet_grid(rows=vars(clockModel),cols=vars(treeModel),scale="free") +
geom_hline(yintercept = 0.95,color="red")+
scale_y_continuous(labels=percent,name="Portion of branches")+
scale_x_discrete(name="branch length percentile")+
scale_fill_brewer(palette = 7,direction = -1,name="True length inside 95% CI: ")+
theme_classic() + theme(legend.position = "bottom",
panel.border = element_rect(colour = "black", fill=NA))
ggsave("HIV-support.pdf",width=8.5,height = 4.7)
d1 %>%  filter(trueTime<p0025 | trueTime>p0975) %>%
mutate(d=ifelse(trueTime<p0025,(p0025-trueTime)/trueTime,(trueTime-p0975)/trueTime)) %>%
ggplot()+
stat_ecdf(aes(x=d,color=clockModel,linetype=treeModel))+
#facet_grid(cols=vars(treeModel),scale="free") +
#geom_vline(xintercept = 1,color="red")+
scale_color_brewer(palette = "Set2")+
scale_x_continuous(name="Portion of branches",trans="log10",labels=percent,
breaks = c(0.01,0.033,0.1,0.33,1,3.3,1))+
coord_cartesian(xlim=c(0.0005,8))+
#scale_x_discrete(name="branch length percentile")+
scale_fill_brewer(palette = 7,direction = -1,name="Inside 95% CI: ")+
theme_bw() + theme(legend.position = "right",
panel.border = element_rect(colour = "black", fill=NA))
d1 %>%  filter(trueTime<p0025 | trueTime>p0975) %>%
mutate(d=ifelse(trueTime<p0025,(p0025-trueTime)/trueTime,(trueTime-p0975)/trueTime)) %>%
ggplot()+
stat_ecdf(aes(x=d,color=clockModel,linetype=treeModel))+
#facet_grid(cols=vars(treeModel),scale="free") +
#geom_vline(xintercept = 1,color="red")+
scale_color_brewer(palette = "Set2")+
scale_x_continuous(name=expression(abs(True - CI)),trans="log10",labels=percent,
breaks = c(0.01,0.033,0.1,0.33,1,3.3,1))+
coord_cartesian(xlim=c(0.0005,8))+
#scale_x_discrete(name="branch length percentile")+
scale_fill_brewer(palette = 7,direction = -1,name="Inside 95% CI: ")+
theme_bw() + theme(legend.position = "right",
panel.border = element_rect(colour = "black", fill=NA))
d1 %>%  filter(trueTime<p0025 | trueTime>p0975) %>%
mutate(d=ifelse(trueTime<p0025,(p0025-trueTime)/trueTime,(trueTime-p0975)/trueTime)) %>%
ggplot()+
stat_ecdf(aes(x=d,color=clockModel,linetype=treeModel))+
#facet_grid(cols=vars(treeModel),scale="free") +
#geom_vline(xintercept = 1,color="red")+
scale_color_brewer(palette = "Set2")+
scale_x_continuous(name=expression(abs(true - CI boundary)/true),trans="log10",labels=percent,
d1 %>%  filter(trueTime<p0025 | trueTime>p0975) %>%
mutate(d=ifelse(trueTime<p0025,(p0025-trueTime)/trueTime,(trueTime-p0975)/trueTime)) %>%
ggplot()+
stat_ecdf(aes(x=d,color=clockModel,linetype=treeModel))+
#facet_grid(cols=vars(treeModel),scale="free") +
#geom_vline(xintercept = 1,color="red")+
scale_color_brewer(palette = "Set2")+
scale_x_continuous(name=expression(abs(true - CI~boundary)/true),trans="log10",labels=percent,
breaks = c(0.01,0.033,0.1,0.33,1,3.3,1))+
coord_cartesian(xlim=c(0.0005,8))+
#scale_x_discrete(name="branch length percentile")+
scale_fill_brewer(palette = 7,direction = -1,name="Inside 95% CI: ")+
theme_bw() + theme(legend.position = "right",
panel.border = element_rect(colour = "black", fill=NA))
d1 %>%  filter(trueTime<p0025 | trueTime>p0975) %>%
mutate(d=ifelse(trueTime<p0025,(p0025-trueTime)/trueTime,(trueTime-p0975)/trueTime)) %>%
ggplot()+
stat_ecdf(aes(x=d,color=clockModel,linetype=treeModel))+
#facet_grid(cols=vars(treeModel),scale="free") +
#geom_vline(xintercept = 1,color="red")+
scale_color_brewer(palette = "Set2")+
scale_x_continuous(name=expression(abs(~true - CI~boundary~)/true),trans="log10",labels=percent,
d1 %>%  filter(trueTime<p0025 | trueTime>p0975) %>%
mutate(d=ifelse(trueTime<p0025,(p0025-trueTime)/trueTime,(trueTime-p0975)/trueTime)) %>%
ggplot()+
stat_ecdf(aes(x=d,color=clockModel,linetype=treeModel))+
#facet_grid(cols=vars(treeModel),scale="free") +
#geom_vline(xintercept = 1,color="red")+
scale_color_brewer(palette = "Set2")+
scale_x_continuous(name=expression(abs(true - CI~boundary~)/true),trans="log10",labels=percent,
d1 %>%  filter(trueTime<p0025 | trueTime>p0975) %>%
mutate(d=ifelse(trueTime<p0025,(p0025-trueTime)/trueTime,(trueTime-p0975)/trueTime)) %>%
ggplot()+
stat_ecdf(aes(x=d,color=clockModel,linetype=treeModel))+
#facet_grid(cols=vars(treeModel),scale="free") +
#geom_vline(xintercept = 1,color="red")+
scale_color_brewer(palette = "Set2")+
scale_x_continuous(name=expression(abs( ~true - CI~boundary~ )/true),trans="log10",labels=percent,
d1 %>%  filter(trueTime<p0025 | trueTime>p0975) %>%
mutate(d=ifelse(trueTime<p0025,(p0025-trueTime)/trueTime,(trueTime-p0975)/trueTime)) %>%
ggplot()+
stat_ecdf(aes(x=d,color=clockModel,linetype=treeModel))+
#facet_grid(cols=vars(treeModel),scale="free") +
#geom_vline(xintercept = 1,color="red")+
scale_color_brewer(palette = "Set2")+
scale_x_continuous(name=expression(abs( true - CI~boundary~ )/true),trans="log10",labels=percent,
d1 %>%  filter(trueTime<p0025 | trueTime>p0975) %>%
mutate(d=ifelse(trueTime<p0025,(p0025-trueTime)/trueTime,(trueTime-p0975)/trueTime)) %>%
ggplot()+
stat_ecdf(aes(x=d,color=clockModel,linetype=treeModel))+
#facet_grid(cols=vars(treeModel),scale="free") +
#geom_vline(xintercept = 1,color="red")+
scale_color_brewer(palette = "Set2")+
scale_x_continuous(name=expression(abs( true - CI~boundary )/true),trans="log10",labels=percent,
breaks = c(0.01,0.033,0.1,0.33,1,3.3,1))+
coord_cartesian(xlim=c(0.0005,8))+
#scale_x_discrete(name="branch length percentile")+
scale_fill_brewer(palette = 7,direction = -1,name="Inside 95% CI: ")+
theme_bw() + theme(legend.position = "right",
panel.border = element_rect(colour = "black", fill=NA))
ggsave("HIV-support-delta.pdf",width=8,height = 2.3)
d2 = dcast(selected+treeModel+clockModel+rep+k~"error",data=d,value.var = "error",fun.aggregate = mean)
ggplot(d2,aes(x=reorder(treeModel,error),y=error,fill=selected)) + #geom_boxplot(outlier.size = 0.2) +
stat_summary(position=position_dodge2(width=0.75),
fun.data = quantiles_95,geom="boxplot") +
stat_summary(position=position_dodge2(width = 0.9),size=0.3) +
xlab("") + scale_y_continuous(name = "divergence time error",labels = percent) +
facet_wrap(~clockModel,scale="free") + theme_classic() +
scale_fill_brewer(name="",palette = "Set2")+
theme(axis.text.x = element_text(angle = 90),
legend.title = element_blank(),legend.position = "none")
ggplot(d2,aes(x=reorder(treeModel,error),y=error,fill=selected)) + #geom_boxplot(outlier.size = 0.2) +
stat_summary(position=position_dodge2(width=0.75),
fun.data = quantiles_95,geom="boxplot") +
stat_summary(position=position_dodge2(width = 0.9),size=0.3) +
xlab("") + scale_y_continuous(name = "divergence time error",labels = percent) +
facet_wrap(~clockModel,scale="free_x") + theme_classic() +
scale_fill_brewer(name="",palette = "Set2")+
theme(axis.text.x = element_text(angle = 90),
legend.title = element_blank(),legend.position = "none")
ggsave("MDCat_HIVsim_crossval_k.pdf",width=8, height=4)
ggplot(d2,aes(x=clockModel,y=error,fill=selected)) + #geom_boxplot(outlier.size = 0.2) +
stat_summary(position=position_dodge2(width=0.75),
fun.data = quantiles_95,geom="boxplot") +
stat_summary(position=position_dodge2(width = 0.9),size=0.3) +
xlab("") + scale_y_continuous(name = "divergence time error",labels = percent) +
facet_wrap(~reorder(treeModel,error),scale="free_x") + theme_classic() +
scale_fill_brewer(name="",palette = "Set2")+
theme(axis.text.x = element_text(angle = 90),
legend.title = element_blank(),legend.position = "none")
ggplot(d2,aes(x=clockModel,y=error,fill=selected)) + #geom_boxplot(outlier.size = 0.2) +
stat_summary(position=position_dodge2(width=0.75),
fun.data = quantiles_95,geom="boxplot") +
stat_summary(position=position_dodge2(width = 0.9),size=0.3) +
xlab("") + scale_y_continuous(name = "divergence time error",labels = percent) +
facet_wrap(~reorder(treeModel,error),scale="free") + theme_classic() +
scale_fill_brewer(name="",palette = "Set2")+
theme(axis.text.x = element_text(angle = 90),
legend.title = element_blank(),legend.position = "none")
ggplot(d2,aes(x=clockModel,y=error,fill=selected)) + #geom_boxplot(outlier.size = 0.2) +
stat_summary(position=position_dodge2(width=0.75),
fun.data = quantiles_95,geom="boxplot") +
stat_summary(position=position_dodge2(width = 0.9),size=0.3) +
xlab("") + scale_y_continuous(name = "divergence time error",labels = percent) +
facet_wrap(~reorder(treeModel,error),scale="free") + theme_classic() +
scale_fill_brewer(name="",palette = "Set2")+
theme(axis.text.x = element_text(angle = 0),
legend.title = element_blank(),legend.position = "none")
ggplot(d2,aes(x=clockModel,y=error,fill=selected)) + #geom_boxplot(outlier.size = 0.2) +
stat_summary(position=position_dodge2(width=0.75),
fun.data = quantiles_95,geom="boxplot") +
stat_summary(position=position_dodge2(width = 0.9),size=0.3) +
xlab("") + scale_y_continuous(name = "divergence time error",labels = percent) +
facet_wrap(~reorder(treeModel,error),scale="free",nrow=1) + theme_classic() +
scale_fill_brewer(name="",palette = "Set2")+
theme(axis.text.x = element_text(angle = 0),
legend.title = element_blank(),legend.position = "none")
ggsave("MDCat_HIVsim_crossval_k.pdf",width=8, height=4)
ggplot(d2,aes(x=sub("Trimodal","Tri-",clockModel),y=error,fill=selected)) + #geom_boxplot(outlier.size = 0.2) +
stat_summary(position=position_dodge2(width=0.75),
fun.data = quantiles_95,geom="boxplot") +
stat_summary(position=position_dodge2(width = 0.9),size=0.3) +
xlab("") + scale_y_continuous(name = "divergence time error",labels = percent) +
facet_wrap(~reorder(treeModel,error),scale="free",nrow=1) + theme_classic() +
scale_fill_brewer(name="",palette = "Set2")+
theme(axis.text.x = element_text(angle = 0),
legend.title = element_blank(),legend.position = "none")
ggplot(d2,aes(x=clockModel,y=error,fill=selected)) + #geom_boxplot(outlier.size = 0.2) +
stat_summary(position=position_dodge2(width=0.75),
fun.data = quantiles_95,geom="boxplot") +
stat_summary(position=position_dodge2(width = 0.9),size=0.3) +
xlab("") + scale_y_continuous(name = "divergence time error",labels = percent) +
facet_wrap(~reorder(treeModel,error),scale="free") + theme_classic() +
scale_fill_brewer(name="",palette = "Set2")+
theme(axis.text.x = element_text(angle = 0),
legend.title = element_blank(),legend.position = "none")
ggsave("MDCat_HIVsim_crossval_k.pdf",width=8, height=5)
qplot((sub("k","",merge(d[d$k == "selected" & d$nodeName =="I1",c(1,2,3,4,6,7,9,13)],
d[d$k != "selected" & d$nodeName =="I1",c(1,2,3,4,5,6,7,9,13)],
by=c("treeModel","clockGroup","rep","clockModel","nodeName","trueAge","estAge","error"))$k)
))+theme_bw()+xlab("k")+ylab("# replicates")
d = read.table("MDCat_HIVsim_vary_k_with_crossval.txt",header=T)
h = data.frame("treeModel"=c("D750_11_10","D750_3_25","D995_11_10","D995_3_25"),
"height"=c(29.3667,66.8334,22.4934,32.4669),
"name"=c("M3","M4","M1","M2"))
head(d)
d = merge(d,h)
d$error = abs(d$trueAge-d$estAge)/d$height
d$clockModel = factor(d$clockModel,levels=c("trilnormcave","trilnormvex","trilnorm"),labels=c("Trimodal1","Trimodal2","Trimodal3"))
d$selected = "Others"
d[d$k == "selected",]$selected = "Cross-validation"
d[d$k == 50,]$selected = "Default (k=50)"
d$selected = factor(d$selected, levels=c("Default (k=50)","Cross-validation","Others"))
dl=merge(d[d$k == "selected" & d$nodeName =="I1",c(1,2,3,4,6,7,9,13)],
d[d$k != "selected" & d$nodeName =="I1",c(1,2,3,4,5,6,7,9,13)],
by=c("treeModel","clockGroup","rep","clockModel","nodeName","trueAge","estAge","error"))$k
qplot((sub("k","",dl)
))+theme_bw()+xlab("k")+ylab("# replicates")
ggsave("selectedk_HIV.pdf",width=2.9, height = 5)
ggplot(d2,aes(x=clockModel,y=error,fill=selected)) + #geom_boxplot(outlier.size = 0.2) +
stat_summary(position=position_dodge2(width=0.75),
fun.data = quantiles_95,geom="boxplot") +
stat_summary(position=position_dodge2(width = 0.9),size=0.3) +
xlab("") + scale_y_continuous(name = "divergence time error",labels = percent) +
facet_wrap(~reorder(treeModel,error),scale="free") + theme_classic() +
scale_fill_brewer(name="",palette = "Set2")+
theme(axis.text.x = element_text(angle = 0),
legend.title = element_blank(),legend.position = "none")
dl=merge(d[d$k == "selected" & d$nodeName =="I1",c(1,2,3,4,6,7,9,13)],
d[d$k != "selected" & d$nodeName =="I1",c(1,2,3,4,5,6,7,9,13)],
by=c("treeModel","clockGroup","rep","clockModel","nodeName","trueAge","estAge","error"))$k
qplot((sub("k","",dl)))+theme_bw()+xlab("k")+ylab("# replicates")
ggsave("selectedk_HIV.pdf",width=2.9, height = 4)
ggsave("selectedk_HIV.pdf",width=3, height = 4)
d = read.table("tmrca.txt",header=T)
h = data.frame("treeModel"=c("D750_11_10","D750_3_25","D995_11_10","D995_3_25"),
"height"=c(29.3667,66.8334,22.4934,32.4669),
"name"=c("M3","M4","M1","M2"))
d = merge(d,h)
d$clockModel =factor(d$clockModel,levels = c("exp","gamma","lognorm",
"clock4","clock3","clock1","clock2",
"trilnormcave","trilnormvex","trilnorm",
"quartlnorm","uniform"),
labels = c("Exponential","Gamma","Lognormal",
"Bimodal 1","Bimodal 2","Bimodal 3","Bimodal 4",
"Trimodal 1","Trimodal 2","Trimodal 3",
"Quartmodal","Uniform"))
d$method = factor(d$method,levels=c("Bstrict","Blnorm","lsd","wlogdate","emd"),
labels=c("BEAST−strict−clock","BEAST−lognormal","LSD","wLogDate","MD-Cat"))
